name: Autofix any basic linting errors
on:
  workflow_dispatch:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
permissions:
  contents: write
jobs:
  lint-and-fix:
    name: Autofix any basic errors
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v2
      with:
        ref: ${{ github.head_ref }}
    - uses: actions/setup-node@v2
      with:
        node-version: '16'
    - name: Install markdownlint
      run: npm install -g markdownlint && npm install -g markdownlint-cli2
    - name: Install textlint and terminology rules
      run: npm install -g textlint && npm install -g textlint-filter-rule-allowlist && npm install -g textlint-rule-terminology
    - name: Setup Git
      run: git config user.name "Github Actions" && git config user.email "noreply@github.com"
    - name: Run markdownlint in fix mode
      run: find . -type f -iname \*.md -exec markdownlint-cli2-fix {} \;
    - name: Run textlint in fix mode
      run: find . -type f -iname \*.md -exec textlint --fix {} \;
    - name: Commit any changes to the branch
      run: git commit -am 'Autofix linter errors' && git push --set-upstream origin "$TARGET_BRANCH"
      env:
        TARGET_BRANCH: ${{ github.head_ref }}
